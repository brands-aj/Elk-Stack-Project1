# Elk-Stack-Project1
This is a collection of Linux and Ansible scripts, most of which were used to configure cloud servers with different docker containers. The final project includes four servers; two of which are running the DVWA containers, the third server is a jump box provisioner, and the fourth server is running the Elk Stack container.
The files in this repository were used to configure the network depicted below.

![Network_Diagram](https://github.com/brands-aj/Elk-Stack-Project1/blob/main/Diagrams/Network_Diagram.drawio.png)

These files have been tested and used to generate a live ELK deployment on Azure. They can be used to either recreate the entire deployment pictured above. Alternatively, select configuration files and playbooks may be used to install only certain pieces of it, such as Filebeat.

[ELK Playbook](https://github.com/brands-aj/Elk-Stack-Project1/blob/main/Ansible/install-elk.yml) 

This document contains the following details:
- Description of the Topology
- Access Policies
- ELK Configuration
  - Beats in Use
  - Machines Being Monitored
- How to Use the Ansible Build


## Description of the Topology

The main purpose of this network is to expose a load-balanced and monitored instance of DVWA, the D*mn Vulnerable Web Application.

The load balancer ensures that the application will be highly available by dispersing traffic amongst multiple servers. 
Additionally, the jump box acts as a controlled means of access to the network.

Integrating an ELK server allows users to easily monitor the vulnerable VMs for changes to the logs and system metrics.

The configuration details of each machine may be found below.

| Name                  | Function           | Private IP Address | Operating System |
|---------------------- |--------------------|--------------------|------------------|
| Jump-Box-Provisioner  | Gateway            | 10.0.0.1           | Linux            |
| Web-1                 | DVWA Container     | 10.0.0.9           | Linux            |
| Web-2                 | DVWA Container     | 10.0.0.10          | Linux            |
| ElkStackVM            |Elk Stack Container | 10.1.0.4           | Linux            |

### Access Policies

The machines on the internal network are not exposed to the public Internet. 

Only the Jump-Box-Provisioner can accept connections from the Internet. Access to this machine is only allowed from the the Host Computer IP address.

Machines within the network can only be accessed by the Host Computer.


A summary of the access policies in place can be found in the table below.

| Name                 | Publicly Accessible | Allowed IP Addresses   |
|----------------------|---------------------|----------------------- |
| Jump-Box-Provisioner | Yes                 | Host Computer IP       |
| Web-1                | No                  | Host Computer/10.0.0.1 |            
| Web-2                | No                  | Host Computer/10.0.0.1 |              |
| ElkStackVM           | No                  | Host Computer/10.0.0.1 |

### Elk Configuration

Ansible was used to automate configuration of the ELK machine. No configuration was performed manually, which is advantageous because it will reduce the likelihood of human error and allow you to easily configure any number of identical machines at one time.

The playbook implements the following tasks:
-Installs docker.io: Downloads the Docker engine software used to run the containers.
-Install python3-pip: Downloads the package used to install Python software.
-Docker module: Installs the pip package. 
-Increase virtual memory: Instructs the target virtual machine to use more memory. 
-Download and install the elk container: Downloads the elk docker container, sebp/elk:761 specifically. 

The following screenshot displays the result of running `docker ps` after successfully configuring the ELK instance.

![Successful_ELK_Installation](https://github.com/brands-aj/Elk-Stack-Project1/blob/main/Ansible/sebp:elk:761.png)

### Target Machines & Beats
This ELK server is configured to monitor both Web-1 (10.0.0.9) and Web-2 (10.0.0.10).

We have installed Filebeat and Metricbeat to these machines.

These Beats allow us to collect the following information from each machine:
Filebeat monitors log files and collects log events for the machine on which it is installed, then forwards the data to Elasticsearch or Logstash for indexing. In this instance, Filebeat is being used to monitor the Apache Server and My SQL database generated by the DVWA. 
Metricbeat is installed on ther servers to collect metrics on the operating system and systms running on the server, such as CPU usage. Like Filebeat, Metricbeat can forward data to Elasticsearch or Logstash for indexing and further analysis.

### Using the Playbook
In order to use the playbook, you will need to have an Ansible control node already configured. Assuming you have such a control node provisioned: 

SSH into the control node and follow the steps below:
- Copy the [ELK Playbook](https://github.com/brands-aj/Elk-Stack-Project1/blob/main/Ansible/install-elk.yml) to /etc/ansible.
- To run the playbook on a specific machine, you must designate the group as the host in the file. For example, elk is the host in this playbook. 
- The elk group was created in the `/etc/ansible/hosts` file and it contains the ElkStackVM. Playbooks are only run on the machines within the host group, e.g., the ElkStackVM. 
    -`cd /etc/hosts` or use the ![Host File](https://github.com/brands-aj/Elk-Stack-Project1/blob/main/Linux/hosts.yml) from this project.
    -Edit the hosts file `nano hosts` and scroll down to # etc/ansible/hosts. If necesasry, you can add a server to an existing group or create another group entirely in this file. 
- If the group exists in the ansible's inventory navigate to the playbook `cd /etc/ansible` and edit the file `nano install-elk.yml`. Add the appropriate group to the hosts line. 
- Run the playbook `ansible-playbook /etc/ansible/install-elk.yml`.
- Navigate to http://20.213.243.20:5601/app/kibana to check that the installation worked as expected.
  
  The following screenshot displays the Kibana dahsboard you should see after successfully installing the playbook.
  ![Kibana Dashboard](https://github.com/brands-aj/Elk-Stack-Project1/blob/main/Ansible/Kibana_Dashboard.png) 
